name: yaml-approval-rules-example
runtime: yaml
description: A minimal Pulumi YAML program for approval rules
config:
  digits:
    type: string
    default: "00000"
  testUserName:
    type: string
    default: pulumi-bot
resources:
  # Create an environment that will be used as the target for our approval rule
  testing-environment:
    type: pulumiservice:Environment
    properties:
      organization: ${pulumi.organization}
      project: test-project
      name: testing-environment-approval-yaml-${digits}
      yaml:
        fn::stringAsset: |-
          values:
            myKey1: "myValue1"

  # Create an approval rule that governs who can approve updates to the environment
  # This rule requires 3 approvals from eligible approvers before any update can proceed
  approval-rule:
    type: pulumiservice:ApprovalRule
    properties:
      name: "My rule!"
      enabled: true
      targetActionTypes: ["update"]
      environmentIdentifier:
        organization: ${testing-environment.organization}
        project: ${testing-environment.project}
        name: ${testing-environment.name}
      approvalRuleConfig:
        numApprovalsRequired: 1
        allowSelfApproval: true
        requireReapprovalOnChange: true
        eligibleApprovers:
          - rbacPermission: "environment:write"
          - user: ${testUserName}
