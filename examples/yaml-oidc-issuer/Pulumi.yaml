name: yaml-oidc-issuer
runtime: yaml
description: A minimal example of provisioning OIDC Issuer via Pulumi YAML

resources:
# A Pulumi OIDC Issuer with a basic policy
  pulumi_issuer:
    type: pulumiservice:index:OidcIssuer
    properties:
      organization: ${pulumi.organization}
      name: pulumi_issuer
      url: https://api.pulumi.com/oidc
      thumbprints:
        - 57d3e89f6b25dde3c174dc558e2b2623306a9d81f88a12e8ae7090a86c12f1da
      policies:
        - decision: allow
          rules:
            aud: urn:pulumi:org:${pulumi.organization}
            sub: pulumi:deploy:org:myTestOrg:project:myTestProject:*
          userLogin: pulumipus
          tokenType: personal
# A Github OIDC Issuer with all types of policies and TLS certificate thumbprint
  github_issuer:
    type: pulumiservice:index:OidcIssuer
    properties:
      organization: ${pulumi.organization}
      name: github_issuer
      url: https://token.actions.githubusercontent.com
      thumbprints:
        - caef08400c87bedb0db28f1a0dc0b49e658c8e90a985b8c3e6a6e7f51a2d09d7
      policies:
        - decision: deny
          rules:
            aud: urn:pulumi:org:${pulumi.organization}
            sub: repo:organization/repo:*
          userLogin: pulumipus
          tokenType: personal
        - decision: allow
          rules:
            aud: urn:pulumi:org:${pulumi.organization}
            sub: repo:organization/repo:*
          authorizedPermissions:
            - admin
          tokenType: organization
        - decision: deny
          rules:
            aud: urn:pulumi:org:${pulumi.organization}
            sub: repo:organization/repo:*
          teamName: dream-team
          tokenType: team